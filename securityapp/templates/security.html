{% extends "base.html" %}
{% block content %}
  <h2>Security Section</h2>
  {% if message %}
    <p>{{ message }}</p>
  {% endif %}

  <hr>

  <h3>Upload Face Image</h3>
  <form
    method="post"
    action="{% url 'security' %}"
    enctype="multipart/form-data"
    style="margin-bottom:20px;"
  >
    {% csrf_token %}
    <input type="hidden" name="action" value="upload">

    <div>
      <label for="face_image">Choose Image:</label>
      <input
        type="file"
        id="face_image"
        name="face_image"
        accept="image/*"
        required
      >
    </div>

    <div style="margin-top:10px;">
      <label for="individual_type">Individual Type:</label>
      <select id="individual_type" name="individual_type" required>
        <option value="protected">Protected</option>
        <option value="warning">Warning</option>
      </select>
    </div>

    <div style="margin-top:10px;">
      <button type="submit" class="btn">Upload Face</button>
    </div>
  </form>

  <hr>

  <h3>Door Control</h3>
  <form
    method="post"
    action="{% url 'security' %}"
    style="display:inline-block; margin-right:10px;"
  >
    {% csrf_token %}
    <input type="hidden" name="action" value="lock">
    <button type="submit" class="btn">Lock Door</button>
  </form>
  <form
    method="post"
    action="{% url 'security' %}"
    style="display:inline-block;"
  >
    {% csrf_token %}
    <input type="hidden" name="action" value="unlock">
    <button type="submit" class="btn">Unlock Door</button>
  </form>

  <hr>


  <div id="video-feed" style="margin-top:20px;">
    <h3>Live Video Feed</h3>
    <img
      id="video-feed-img"
      src="{% url 'video_feed' %}"
      alt="Video Feed"
      style="width:100%;"
    >
  </div>

  <script>
    document.addEventListener('keyup', function(e) {
      if (e.key === "Escape") {
        document.getElementById('video-feed').style.display = 'none';
      }
    });
  </script>
{% endblock %}
